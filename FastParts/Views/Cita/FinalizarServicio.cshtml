@model FastParts.Models.CitaFinalizarViewModel
@{
    ViewBag.Title = "Finalizar Servicio";
}

<div class="container mt-4">
    <h2 class="mb-4">Finalizar Servicio</h2>

    @using (Html.BeginForm("FinalizarServicio", "Cita", FormMethod.Post, new { enctype = "multipart/form-data", @id = "formFinalizarServicio" }))
    {
        @Html.AntiForgeryToken()
        @Html.HiddenFor(m => m.CitaId)
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })

        <div class="card shadow-sm">
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-6">
                        @Html.LabelFor(m => m.FotoAntes, "Foto antes", new { @class = "form-label" })
                        @Html.TextBoxFor(m => m.FotoAntes, new { type = "file", @class = "form-control", accept = "image/*" })
                        @Html.ValidationMessageFor(m => m.FotoAntes, "", new { @class = "text-danger" })
                    </div>
                    <div class="col-md-6">
                        @Html.LabelFor(m => m.FotoDespues, "Foto después", new { @class = "form-label" })
                        @Html.TextBoxFor(m => m.FotoDespues, new { type = "file", @class = "form-control", accept = "image/*" })
                        @Html.ValidationMessageFor(m => m.FotoDespues, "", new { @class = "text-danger" })
                    </div>
                </div>

                <div class="mb-3">
                    @Html.LabelFor(m => m.Motivo, "Observaciones / Detalle del trabajo realizado", new { @class = "form-label" })
                    @Html.TextAreaFor(m => m.Motivo, 5, 60, new { @class = "form-control" })
                    @Html.ValidationMessageFor(m => m.Motivo, "", new { @class = "text-danger" })
                </div>

                <div class="d-flex justify-content-end">
                    <a href="@Url.Action("MisCitasMecanico", "Cita")" class="btn btn-secondary me-2">Cancelar</a>
                    <button type="submit" class="btn btn-primary" id="btnFinalizarServicio">Finalizar servicio</button>
                </div>
            </div>
        </div>
    }
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")

    <script>
        $("#btnFinalizarServicio").on("click", function (e) {
            e.preventDefault();

            Swal.fire({
                title: '¿Finalizar servicio?',
                text: 'Se registrará la hora final y las fotos adjuntas.',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Sí, finalizar',
                cancelButtonText: 'Cancelar'
            }).then(result => {
                if (result.isConfirmed) {
                    $("#formFinalizarServicio").off("submit").submit();
                }
            });
        });
    </script>
}

